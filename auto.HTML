```html
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Autorisations de Sortie et Avances sur Salaire</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#e6f0ff',
                            100: '#cce0ff',
                            200: '#99c2ff',
                            300: '#66a3ff',
                            400: '#3385ff',
                            500: '#0066ff',
                            600: '#0052cc',
                            700: '#003d99',
                            800: '#002966',
                            900: '#001433',
                        }
                    }
                }
            }
        }

        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            document.documentElement.classList.toggle('dark', event.matches);
        });
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');
        body { font-family: 'Roboto', sans-serif; }
        .notification { animation: fadeIn 0.5s, fadeOut 0.5s 2.5s forwards; pointer-events: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-20px); } }
        .view-transition { animation: fadeInView 0.3s ease-out; }
        @keyframes fadeInView { from { opacity: 0; } to { opacity: 1; } }
        .custom-table { border-collapse: separate; border-spacing: 0; }
        .custom-table th, .custom-table td { border-bottom-width: 1px; }
        .status-badge { display: inline-flex; align-items: center; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; }
        .status-pending { background-color: rgba(234, 179, 8, 0.1); color: rgb(234, 179, 8); border: 1px solid rgba(234, 179, 8, 0.2); }
        .status-approved { background-color: rgba(34, 197, 94, 0.1); color: rgb(34, 197, 94); border: 1px solid rgba(34, 197, 94, 0.2); }
        .status-rejected { background-color: rgba(239, 68, 68, 0.1); color: rgb(239, 68, 68); border: 1px solid rgba(239, 68, 68, 0.2); }
        .dark .status-pending { background-color: rgba(234, 179, 8, 0.2); }
        .dark .status-approved { background-color: rgba(34, 197, 94, 0.2); }
        .dark .status-rejected { background-color: rgba(239, 68, 68, 0.2); }
        .file-input-label { display: inline-flex; align-items: center; padding: 0.5rem 1rem; border: 1px solid #d1d5db; border-radius: 0.375rem; cursor: pointer; background-color: #ffffff; transition: all 0.2s; }
        .file-input-label:hover { background-color: #f3f4f6; }
        .dark .file-input-label { background-color: #374151; border-color: #4b5563; }
        .dark .file-input-label:hover { background-color: #4b5563; }
    </style>
</head>
<body class="min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
    <div id="notification-container" class="fixed top-4 right-4 z-50 pointer-events-none"></div>

    <header class="bg-white dark:bg-gray-800 shadow">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="h-10 w-10 rounded-full bg-primary-500 flex items-center justify-center text-white font-bold text-lg">AS</div>
                </div>
                <h1 class="ml-3 text-xl font-bold text-gray-900 dark:text-white">Autorisations de Sortie & Avances sur Salaire</h1>
            </div>
            <div id="user-info" class="flex items-center">
                <div class="mr-3 text-sm text-right">
                    <p class="font-medium user-name">Non connecté</p>
                    <p class="text-gray-500 dark:text-gray-400 user-role"></p>
                </div>
                <button id="logout-button" class="hidden text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div id="login-view" class="view-transition">
            <div class="max-w-md mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
                <div class="p-6">
                    <h2 class="text-2xl font-bold text-center mb-6">Connexion</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Email</label>
                            <input type="email" id="email" class="mt-1 text-base block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white" placeholder="Entrez votre email">
                        </div>
                        <div>
                            <label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Mot de passe</label>
                            <input type="password" id="password" class="mt-1 text-base block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white" placeholder="••••••••">
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <input id="remember-me" type="checkbox" class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                                <label for="remember-me" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Se souvenir de moi</label>
                            </div>
                            <div class="text-sm">
                                <a href="#" class="font-medium text-primary-600 hover:text-primary-500 dark:text-primary-400">Mot de passe oublié ?</a>
                            </div>
                        </div>
                        <div>
                            <button id="btn-login-email" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                                <i class="fas fa-sign-in-alt mr-2"></i> Se connecter
                            </button>
                        </div>
                        <div class="relative">
                            <div class="absolute inset-0 flex items-center">
                                <div class="w-full border-t border-gray-300 dark:border-gray-600"></div>
                            </div>
                            <div class="relative flex justify-center text-sm">
                                <span class="px-2 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400">Ou continuer avec</span>
                            </div>
                        </div>
                        <div>
                            <button id="btn-login-google" class="w-full flex justify-center py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                                <i class="fab fa-google mr-2"></i> Google
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="employee-view" class="view-transition hidden space-y-8">
            <div class="bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden">
                <div class="p-6">
                    <h2 class="text-lg font-semibold mb-6">Nouvelle demande d'autorisation de sortie</h2>
                    <form id="leave-request-form" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="leave-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Date</label>
                                <input type="date" id="leave-date" name="leave-date" required class="mt-1 text-base block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white">
                            </div>
                            <div>
                                <label for="leave-reason" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Motif</label>
                                <select id="leave-reason" name="leave-reason" required class="mt-1 text-base block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white">
                                    <option value="" disabled selected>Sélectionnez un motif</option>
                                    <option value="Rendez-vous médical">Rendez-vous médical</option>
                                    <option value="Urgence familiale">Urgence familiale</option>
                                    <option value="Course professionnelle">Course professionnelle</option>
                                    <option value="Autre">Autre</option>
                                </select>
                            </div>
                            <div>
                                <label for="leave-start-time" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Heure de sortie</label>
                                <input type="time" id="leave-start-time" name="leave-start-time" required class="mt-1 text-base block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white">
                            </div>
                            <div>
                                <label for="leave-end-time" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Heure de retour estimée</label>
                                <input type="time" id="leave-end-time" name="leave-end-time" required class="mt-1 text-base block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white">
                            </div>
                        </div>
                        <div id="other-reason-container" class="hidden">
                            <label for="other-reason" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Précisez le motif</label>
                            <textarea id="other-reason" name="other-reason" rows="3" class="mt-1 text-base block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white" placeholder="Détaillez votre motif..."></textarea>
                        </div>
                        <div class="flex justify-end">
                            <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                                <i class="fas fa-paper-plane mr-2"></i> Soumettre la demande
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden">
                <div class="p-6">
                    <h2 class="text-lg font-semibold mb-6">Nouvelle demande d'avance sur salaire</h2>
                    <form id="advance-request-form" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="advance-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Date de la demande</label>
                                <input type="date" id="advance-date" name="advance-date" required class="mt-1 text-base block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white">
                            </div>
                            <div>
                                <label for="advance-amount" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Montant demandé</label>
                                <input type="number" id="advance-amount" name="advance-amount" min="0" step="0.01" required class="mt-1 text-base block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white" placeholder="Entrez le montant">
                            </div>
                        </div>
                        <div class="flex justify-end">
                            <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                                <i class="fas fa-paper-plane mr-2"></i> Soumettre la demande
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden">
                <div class="p-6">
                    <h2 class="text-lg font-semibold mb-6">Historique des demandes</h2>
                    <div class="overflow-x-auto">
                        <table id="employee-requests-table" class="min-w-full custom-table">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Type</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Date</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Détails</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Statut</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Commentaire</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200 dark:divide-gray-600 bg-white dark:bg-gray-800"></tbody>
                        </table>
                        <div id="employee-no-requests" class="py-6 text-center text-gray-500 dark:text-gray-400">
                            <p>Aucune demande pour le moment.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="manager-view" class="view-transition hidden space-y-8">
            <div class="bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden">
                <div class="p-6">
                    <h2 class="text-lg font-semibold mb-6">Demandes en attente</h2>
                    <div class="overflow-x-auto">
                        <table id="pending-requests-table" class="min-w-full custom-table">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Employé</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Type</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Date</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Détails</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200 dark:divide-gray-600 bg-white dark:bg-gray-800"></tbody>
                        </table>
                        <div id="manager-no-pending" class="py-6 text-center text-gray-500 dark:text-gray-400">
                            <p>Aucune demande en attente pour le moment.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden">
                <div class="p-6">
                    <h2 class="text-lg font-semibold mb-6">Historique des demandes traitées</h2>
                    <div class="overflow-x-auto">
                        <table id="processed-requests-table" class="min-w-full custom-table">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Employé</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Type</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Date</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Détails</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Statut</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Commentaire</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200 dark:divide-gray-600 bg-white dark:bg-gray-800"></tbody>
                        </table>
                        <div id="manager-no-processed" class="py-6 text-center text-gray-500 dark:text-gray-400">
                            <p>Aucune demande traitée pour le moment.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden">
                <div class="p-6">
                    <h2 class="text-lg font-semibold mb-6">Gestion des utilisateurs</h2>
                    <div class="space-y-4">
                        <div class="flex items-center space-x-4">
                            <input type="file" id="excel-upload" accept=".xlsx, .xls" class="hidden">
                            <label for="excel-upload" class="file-input-label text-sm font-medium text-gray-700 dark:text-gray-300">
                                <i class="fas fa-file-excel mr-2"></i> Sélectionner un fichier Excel
                            </label>
                            <button id="import-excel-btn" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                                <i class="fas fa-upload mr-2"></i> Importer
                            </button>
                        </div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Importez un fichier Excel contenant les utilisateurs (colonnes : id, name, email, role, password).</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="modal-container" class="fixed inset-0 z-10 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"></div>
            </div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true"></span>
            <div id="modal-content" class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"></div>
        </div>
    </div>

    <script>
        const appData = {
            users: [
                { id: 76, name: "ALILI HOUSSEM", email: "ALILIHOUSSEM@EASYWAYELECTO.COM", role: "Responsable", password: "1234" }
            ],
            requests: [],
            currentUser: null
        };

        function formatDate(dateStr) {
            const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
            return new Date(dateStr).toLocaleDateString('fr-FR', options);
        }

        function getStatusClass(status) {
            switch(status) {
                case "En attente": return "status-pending";
                case "Approuvée": return "status-approved";
                case "Refusée": return "status-rejected";
                default: return "";
            }
        }

        function getStatusIcon(status) {
            switch(status) {
                case "En attente": return '<i class="fas fa-clock mr-1"></i>';
                case "Approuvée": return '<i class="fas fa-check mr-1"></i>';
                case "Refusée": return '<i class="fas fa-times mr-1"></i>';
                default: return "";
            }
        }

        function getUserById(id) {
            const user = appData.users.find(user => user.id === id);
            if (!user) {
                console.error(`Utilisateur avec id ${id} non trouvé.`);
                return { name: "Employé inconnu" };
            }
            return user;
        }

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notification-container');
            const notificationEl = document.createElement('div');
            notificationEl.className = `notification mb-2 p-3 rounded-lg shadow-lg max-w-md ${
                type === 'success' ? 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-100' : 
                type === 'error' ? 'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-100' : 
                'bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-100'
            }`;
            const icon = type === 'success' ? '<i class="fas fa-check-circle mr-2"></i>' : 
                        type === 'error' ? '<i class="fas fa-exclamation-circle mr-2"></i>' : 
                        '<i class="fas fa-info-circle mr-2"></i>';
            notificationEl.innerHTML = `<div class="flex items-center">${icon}<span>${message}</span></div>`;
            container.appendChild(notificationEl);
            setTimeout(() => notificationEl.remove(), 3000);
        }

        function showView(viewId) {
            document.querySelectorAll('main > div[id$="-view"]').forEach(view => view.classList.add('hidden'));
            const viewToShow = document.getElementById(viewId);
            if (viewToShow) {
                viewToShow.classList.remove('hidden');
                viewToShow.classList.add('view-transition');
                if (viewId === 'employee-view') updateEmployeeRequestsTable();
                else if (viewId === 'manager-view') updateManagerRequestsTables();
            }
        }

        function showModal(title, content, actions) {
            const modalContainer = document.getElementById('modal-container');
            const modalContent = document.getElementById('modal-content');
            modalContent.innerHTML = `
                <div class="p-6">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white">${title}</h3>
                    <div class="mt-4">${content}</div>
                    <div class="mt-6 flex flex-row-reverse gap-2">${actions}</div>
                </div>
            `;
            modalContainer.classList.remove('hidden');
            modalContent.querySelectorAll('.modal-close').forEach(button => {
                button.addEventListener('click', closeModal);
            });
        }

        function closeModal() {
            document.getElementById('modal-container').classList.add('hidden');
        }

        function setupLeaveRequestForm() {
            const form = document.getElementById('leave-request-form');
            const reasonSelect = document.getElementById('leave-reason');
            const otherReasonContainer = document.getElementById('other-reason-container');

            reasonSelect.addEventListener('change', function() {
                const isOther = this.value === 'Autre';
                otherReasonContainer.classList.toggle('hidden', !isOther);
                document.getElementById('other-reason').toggleAttribute('required', isOther);
            });

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                const date = document.getElementById('leave-date').value;
                const startTime = document.getElementById('leave-start-time').value;
                const endTime = document.getElementById('leave-end-time').value;
                let reason = reasonSelect.value;
                const today = new Date().toISOString().split('T')[0];

                if (date < today) {
                    showNotification("La date ne peut pas être dans le passé.", "error");
                    return;
                }
                if (startTime >= endTime) {
                    showNotification("L'heure de retour doit être postérieure à l'heure de sortie.", "error");
                    return;
                }
                if (!reason) {
                    showNotification("Veuillez sélectionner un motif.", "error");
                    return;
                }

                if (reason === 'Autre') {
                    const otherReason = document.getElementById('other-reason').value.trim();
                    if (!otherReason) {
                        showNotification("Veuillez préciser le motif de votre sortie.", "error");
                        return;
                    }
                    reason = otherReason;
                }

                const newRequest = {
                    id: appData.requests.length + 1,
                    type: "Autorisation de sortie",
                    date,
                    details: `De ${startTime} à ${endTime} - ${reason}`,
                    status: "En attente",
                    employeeId: appData.currentUser.id,
                    managerId: 76,
                    createdAt: new Date(),
                    comment: ""
                };

                appData.requests.push(newRequest);
                form.reset();
                otherReasonContainer.classList.add('hidden');
                updateEmployeeRequestsTable();
                showNotification("Votre demande a été soumise avec succès.", "success");
            });
        }

        function setupAdvanceRequestForm() {
            const form = document.getElementById('advance-request-form');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                const date = document.getElementById('advance-date').value;
                const amount = document.getElementById('advance-amount').value;
                const today = new Date().toISOString().split('T')[0];

                if (date < today) {
                    showNotification("La date ne peut pas être dans le passé.", "error");
                    return;
                }
                if (amount <= 0) {
                    showNotification("Le montant doit être supérieur à 0.", "error");
                    return;
                }

                const newRequest = {
                    id: appData.requests.length + 1,
                    type: "Avance sur salaire",
                    date,
                    details: `Montant : ${amount} €`,
                    status: "En attente",
                    employeeId: appData.currentUser.id,
                    managerId: 76,
                    createdAt: new Date(),
                    comment: ""
                };

                appData.requests.push(newRequest);
                form.reset();
                updateEmployeeRequestsTable();
                showNotification("Votre demande d'avance sur salaire a été soumise avec succès.", "success");
            });
        }

        function updateEmployeeRequestsTable() {
            if (!appData.currentUser || appData.currentUser.role !== "Employé") return;
            const tableBody = document.querySelector('#employee-requests-table tbody');
            const noRequestsMessage = document.getElementById('employee-no-requests');
            const employeeRequests = appData.requests.filter(req => req.employeeId === appData.currentUser.id)
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            if (employeeRequests.length === 0) {
                tableBody.innerHTML = '';
                noRequestsMessage.style.display = 'block';
                return;
            }

            noRequestsMessage.style.display = 'none';
            tableBody.innerHTML = employeeRequests.map(req => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">${req.type}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">${formatDate(req.date)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">${req.details}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="status-badge ${getStatusClass(req.status)}">${getStatusIcon(req.status)} ${req.status}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">${req.comment}</td>
                </tr>
            `).join('');
        }

        function updateManagerRequestsTables() {
            if (!appData.currentUser || appData.currentUser.role !== "Responsable") return;
            const pendingTableBody = document.querySelector('#pending-requests-table tbody');
            const noPendingMessage = document.getElementById('manager-no-pending');
            const pendingRequests = appData.requests.filter(req => req.status === "En attente")
                .sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));

            if (pendingRequests.length === 0) {
                pendingTableBody.innerHTML = '';
                noPendingMessage.style.display = 'block';
            } else {
                noPendingMessage.style.display = 'none';
                pendingTableBody.innerHTML = pendingRequests.map(req => {
                    const employee = getUserById(req.employeeId);
                    return `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">${employee ? employee.name : 'Employé inconnu'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">${req.type}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">${formatDate(req.date)}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">${req.details}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm">
                                <div class="flex space-x-2">
                                    <button data-request-id="${req.id}" class="approve-btn px-3 py-1 bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100 rounded-md hover:bg-green-200 dark:hover:bg-green-700">
                                        <i class="fas fa-check mr-1"></i> Approuver
                                    </button>
                                    <button data-request-id="${req.id}" class="reject-btn px-3 py-1 bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100 rounded-md hover:bg-red-200 dark:hover:bg-red-700">
                                        <i class="fas fa-times mr-1"></i> Refuser
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');

                pendingTableBody.querySelectorAll('.approve-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        approveRequest(parseInt(this.getAttribute('data-request-id')));
                    });
                });

                pendingTableBody.querySelectorAll('.reject-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        showRejectModal(parseInt(this.getAttribute('data-request-id')));
                    });
                });
            }

            const processedTableBody = document.querySelector('#processed-requests-table tbody');
            const noProcessedMessage = document.getElementById('manager-no-processed');
            const processedRequests = appData.requests.filter(req => req.status !== "En attente")
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            if (processedRequests.length === 0) {
                processedTableBody.innerHTML = '';
                noProcessedMessage.style.display = 'block';
            } else {
                noProcessedMessage.style.display = 'none';
                processedTableBody.innerHTML = processedRequests.map(req => {
                    const employee = getUserById(req.employeeId);
                    return `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">${employee ? employee.name : 'Employé inconnu'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">${req.type}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">${formatDate(req.date)}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">${req.details}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="status-badge ${getStatusClass(req.status)}">${getStatusIcon(req.status)} ${req.status}</span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">${req.comment}</td>
                        </tr>
                    `;
                }).join('');
            }
        }

        function approveRequest(requestId) {
            const request = appData.requests.find(req => req.id === requestId);
            if (!request) return;
            request.status = "Approuvée";
            request.comment = "";
            updateManagerRequestsTables();
            showNotification(`La demande de ${getUserById(request.employeeId).name} a été approuvée.`, "success");
        }

        function showRejectModal(requestId) {
            const request = appData.requests.find(req => req.id === requestId);
            if (!request) return;
            const employee = getUserById(request.employeeId);
            const modalContent = `
                <p class="text-gray-700 dark:text-gray-300">
                    Vous êtes sur le point de refuser la demande de ${employee.name} pour le ${formatDate(request.date)}.
                </p>
                <div class="mt-4">
                    <label for="reject-reason" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Motif du refus (optionnel)</label>
                    <textarea id="reject-reason" rows="3" class="mt-1 text-base block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white" placeholder="Expliquez pourquoi vous refusez cette demande..."></textarea>
                </div>
            `;
            const modalActions = `
                <button id="confirm-reject" class="inline-flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                    Confirmer le refus
                </button>
                <button class="modal-close inline-flex justify-center py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    Annuler
                </button>
            `;
            showModal(`Refuser la demande`, modalContent, modalActions);
            document.getElementById('confirm-reject').addEventListener('click', function() {
                rejectRequest(requestId, document.getElementById('reject-reason').value.trim());
                closeModal();
            });
        }

        function rejectRequest(requestId, comment = "") {
            const request = appData.requests.find(req => req.id === requestId);
            if (!request) return;
            request.status = "Refusée";
            request.comment = comment;
            updateManagerRequestsTables();
            showNotification(`La demande de ${getUserById(request.employeeId).name} a été refusée.`, "success");
        }

        function setupLoginForm() {
            document.getElementById('btn-login-email').addEventListener('click', function(e) {
                e.preventDefault();
                const email = document.getElementById('email').value.trim();
                const password = document.getElementById('password').value;

                if (!email) return showNotification("Veuillez entrer votre email.", "error");
                if (!password) return showNotification("Veuillez entrer votre mot de passe.", "error");

                const user = appData.users.find(u => u.email.toLowerCase() === email.toLowerCase() && u.password === password);
                if (user) login(user);
                else showNotification("Email ou mot de passe incorrect. Veuillez réessayer.", "error");
            });

            document.getElementById('btn-login-google').addEventListener('click', function(e) {
                e.preventDefault();
                showNotification("Fonction de connexion Google non disponible dans cette démo.", "info");
            });

            document.getElementById('logout-button').addEventListener('click', logout);
        }

        function login(user) {
            appData.currentUser = user;
            document.querySelector('.user-name').textContent = user.name;
            document.querySelector('.user-role').textContent = user.role;
            document.getElementById('logout-button').classList.remove('hidden');
            showView(user.role === "Employé" ? 'employee-view' : 'manager-view');
            showNotification(`Bienvenue, ${user.name} !`, "success");
        }

        function logout() {
            appData.currentUser = null;
            document.querySelector('.user-name').textContent = "Non connecté";
            document.querySelector('.user-role').textContent = "";
            document.getElementById('logout-button').classList.add('hidden');
            showView('login-view');
            showNotification("Vous avez été déconnecté.", "info");
        }

        function setupExcelImport() {
            const importBtn = document.getElementById('import-excel-btn');
            const fileInput = document.getElementById('excel-upload');

            importBtn.addEventListener('click', function() {
                const file = fileInput.files[0];
                if (!file) {
                    showNotification("Veuillez sélectionner un fichier Excel.", "error");
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                    if (jsonData.length === 0) {
                        showNotification("Le fichier Excel est vide.", "error");
                        return;
                    }

                    const newUsers = jsonData.map(row => {
                        if (!row.id || !row.name || !row.email || !row.role || !row.password) {
                            showNotification("Certaines lignes du fichier Excel sont incomplètes.", "error");
                            return null;
                        }

                        const role = row.role.trim();
                        if (role !== "Employé" && role !== "Responsable") {
                            showNotification(`Le rôle "${row.role}" n'est pas valide. Les rôles autorisés sont "Employé" et "Responsable".`, "error");
                            return null;
                        }

                        const existingUser = appData.users.find(u => u.id === row.id);
                        if (existingUser) {
                            showNotification(`Un utilisateur avec l'id ${row.id} existe déjà.`, "error");
                            return null;
                        }

                        return {
                            id: row.id,
                            name: row.name.toString().trim(),
                            email: row.email.toString().trim(),
                            role: role,
                            password: row.password.toString().trim()
                        };
                    }).filter(user => user !== null);

                    if (newUsers.length === 0) {
                        showNotification("Aucun utilisateur valide n'a été trouvé dans le fichier Excel.", "error");
                        return;
                    }

                    appData.users = appData.users.concat(newUsers);
                    fileInput.value = '';
                    showNotification(`${newUsers.length} utilisateur(s) importé(s) avec succès.`, "success");
                    console.log("Utilisateurs importés :", newUsers);
                };
                reader.onerror = function() {
                    showNotification("Erreur lors de la lecture du fichier.", "error");
                };
                reader.readAsArrayBuffer(file);
            });
        }

        function initApp() {
            setupLoginForm();
            setupLeaveRequestForm();
            setupAdvanceRequestForm();
            setupExcelImport();
            showView('login-view');
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('leave-date').setAttribute('min', today);
            document.getElementById('leave-date').value = today;
            document.getElementById('advance-date').setAttribute('min', today);
            document.getElementById('advance-date').value = today;
        }

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
```
